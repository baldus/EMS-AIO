{% extends "layout.html" %}
{% block title %}{{ page.title }} | EMS Home{% endblock %}
{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h2 style="margin-bottom: 0.25rem;">{{ page.title }}</h2>
            <div style="font-size: 0.9rem; color: #4b5563;">
                Created: {{ page.created_at }} · Last edited: {{ page.last_edited_at or "—" }} · Last viewed: {{ page.last_viewed_at or "—" }}
            </div>
            {% if page.archived_at %}
            <div style="margin-top: 0.5rem; color: #b45309;">Archived on {{ page.archived_at }}</div>
            {% endif %}
        </div>
        <div>
            {% if current_user.role in ['Admin', 'Editor'] and not page.archived_at %}
                <a href="{{ url_for('pages.page_edit', page_id=page.id) }}">Edit</a>
                <form action="{{ url_for('pages.page_archive', page_id=page.id) }}" method="post" class="inline" onsubmit="return confirm('Archive this page?');">
                    <button type="submit">Archive</button>
                </form>
            {% elif current_user.role in ['Admin', 'Editor'] and page.archived_at %}
                <form action="{{ url_for('pages.page_restore', page_id=page.id) }}" method="post" class="inline">
                    <button type="submit">Restore</button>
                </form>
            {% endif %}
        </div>
    </div>

    <hr style="margin: 1rem 0;">

    {% if page.blocks %}
        {% for block in page.blocks %}
            <div style="margin-bottom: 1rem;">
                {% if block.type == 'heading' %}
                    <h3>{{ block.content_json.text }}</h3>
                {% elif block.type == 'text' %}
                    <p>{{ block.content_json.text }}</p>
                {% elif block.type == 'bulleted_list' %}
                    <ul>
                        {% for item in block.content_json.items %}
                            <li>{{ item }}</li>
                        {% endfor %}
                    </ul>
                {% elif block.type == 'checkbox_list' %}
                    <ul style="list-style: none; padding-left: 0;">
                        {% for item in block.content_json.items %}
                        <li>
                            <label>
                                <input type="checkbox" disabled {% if item.checked %}checked{% endif %}>
                                {{ item.text }}
                            </label>
                        </li>
                        {% endfor %}
                    </ul>
                {% elif block.type == 'divider' %}
                    <hr>
                {% elif block.type == 'callout' %}
                    <div style="border-left: 4px solid #60a5fa; padding: 0.5rem 0.75rem; background: #eef2ff;">
                        <strong>{{ block.content_json.style|capitalize }}:</strong>
                        {{ block.content_json.text }}
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        <p>No blocks yet.</p>
    {% endif %}
</div>
{% endblock %}
