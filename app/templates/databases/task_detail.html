{% extends "layout.html" %}
{% block title %}Task {{ task.id }} | EMS Home{% endblock %}
{% block content %}
<div class="card">
<h2>{{ task.title }}</h2>
<p>Status: {{ task.status }}</p>
<p>Due Date: {{ task.due_date or '-' }}</p>
<p>Project: {% if task.project %}<a href="{{ url_for('databases.project_detail', project_id=task.project.id) }}">{{ task.project.name }}</a>{% else %}-{% endif %}</p>
{% if current_user.role == 'Admin' or (current_user.role == 'Editor' and task.created_by_user_id == current_user.id) %}
<a class="button-link" href="{{ url_for('databases.task_edit', task_id=task.id) }}">Edit Task</a>
<form method="post" action="{{ url_for('databases.task_delete', task_id=task.id) }}" class="inline" onsubmit="return confirm('Delete this record?');"><button type="submit">Delete</button></form>
{% endif %}
</div>
<div class="card">
<h3>Linked Pages</h3>
<ul>
{% for link in task.task_page_links %}
<li>{{ link.page.title }}
{% if current_user.role == 'Admin' or (current_user.role == 'Editor' and task.created_by_user_id == current_user.id) %}
<form class="inline" method="post" action="{{ url_for('databases.task_link_page', task_id=task.id) }}"><input type="hidden" name="page_id" value="{{ link.page.id }}"><input type="hidden" name="action" value="unlink"><button type="submit">Unlink</button></form>
{% endif %}
</li>
{% else %}<li>No linked pages.</li>{% endfor %}
</ul>
{% if current_user.role == 'Admin' or (current_user.role == 'Editor' and task.created_by_user_id == current_user.id) %}
<form method="post" action="{{ url_for('databases.task_link_page', task_id=task.id) }}">
<label>Link Page
<select name="page_id">{% for page in pages %}{% if page.id not in linked_page_ids %}<option value="{{ page.id }}">{{ page.title }}</option>{% endif %}{% endfor %}</select>
</label>
<input type="hidden" name="action" value="link">
<button type="submit">Link Page</button>
</form>
{% endif %}
</div>
{% endblock %}
